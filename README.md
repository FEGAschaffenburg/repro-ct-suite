# Repro CT-Suite

[![Version](https://img.shields.io/github/v/release/FEGAschaffenburg/repro-ct-suite)](https://github.com/FEGAschaffenburg/repro-ct-suite/releases)
[![WordPress](https://img.shields.io/badge/WordPress-5.0%2B-blue)](https://wordpress.org/)
[![PHP](https://img.shields.io/badge/PHP-7.4%2B-purple)](https://www.php.net/)
[![License](https://img.shields.io/github/license/FEGAschaffenburg/repro-ct-suite)](LICENSE)

WordPress-Plugin zur Integration von ChurchTools-Daten in WordPress.

## üìã Beschreibung

Repro CT-Suite ist ein WordPress-Plugin, das eine Br√ºcke zwischen ChurchTools und Ihrer WordPress-Website herstellt. Es synchronisiert Termin- und Veranstaltungsdaten aus ChurchTools und macht sie in WordPress verf√ºgbar f√ºr Kalenderansichten, Widgets und andere Darstellungen.

## ‚ú® Features

### ChurchTools-Integration
- ‚úÖ **Sichere API-Verbindung** zu ChurchTools mit Cookie-basierter Authentifizierung
- ‚úÖ **Kalender-Verwaltung**: Auswahl der zu synchronisierenden Kalender
- ‚úÖ **Termine (Appointments)**: Abruf und Synchronisation von Terminen
- ‚úÖ **Veranstaltungen (Events)**: Abruf und Synchronisation von Events
- ‚úÖ **AJAX-Synchronisation**: Sync ohne Seitenneuladen
- ‚úÖ **Kombinierte Ansicht**: Termine und Events in einer √úbersicht
- ‚úÖ **Dashboard**: √úbersichtliche Anzeige der n√§chsten Termine

### Technische Features
- ‚úÖ **Moderner Code**: Objektorientierte PHP-Architektur
- ‚úÖ **Repository Pattern**: Saubere Datenbankabstraktion
- ‚úÖ **Service Layer**: Gesch√§ftslogik getrennt von Pr√§sentation
- ‚úÖ **Migrationen**: Automatische Datenbank-Updates
- ‚úÖ **AJAX-API**: Asynchrone Datenaktualisierung
- ‚úÖ **GitHub Updater**: Automatische Updates direkt von GitHub
- ‚úÖ **Internationalisierung**: i18n-ready
- ‚úÖ **WordPress Standards**: Folgt WordPress Coding Standards

## üöÄ Installation

### Voraussetzungen
- WordPress 5.0 oder h√∂her
- PHP 7.4 oder h√∂her  
- ChurchTools-Instanz mit Zugang
- MySQL/MariaDB

### Automatische Installation (empfohlen)

1. Laden Sie die neueste Version von [Releases](https://github.com/FEGAschaffenburg/repro-ct-suite/releases) herunter
2. Gehen Sie zu **WordPress Admin ‚Üí Plugins ‚Üí Installieren**
3. Klicken Sie auf **Plugin hochladen**
4. W√§hlen Sie die ZIP-Datei aus
5. Aktivieren Sie das Plugin

### Manuelle Installation

```bash
cd wp-content/plugins/
git clone https://github.com/FEGAschaffenburg/repro-ct-suite.git
cd repro-ct-suite
```

## ‚öôÔ∏è Konfiguration

### Erste Schritte

1. Navigieren Sie zu **WordPress Admin ‚Üí Repro CT-Suite**
2. Tragen Sie Ihre ChurchTools-Zugangsdaten ein:
   - **Tenant**: Ihr ChurchTools-Subdomain (z.B. `ihre-gemeinde` f√ºr `ihre-gemeinde.church.tools`)
   - **Benutzername**: Ihr ChurchTools-Benutzername
   - **Passwort**: Ihr ChurchTools-Passwort (wird verschl√ºsselt gespeichert)
3. Klicken Sie auf **Verbindung testen**
4. Wechseln Sie zum Tab **Settings**
5. Klicken Sie auf **Kalender jetzt synchronisieren**
6. W√§hlen Sie die gew√ºnschten Kalender aus
7. Speichern Sie die Auswahl
8. Synchronisieren Sie die Termine im **Dashboard**

### Kalender-Auswahl

Im Settings-Tab k√∂nnen Sie:
- Alle verf√ºgbaren Kalender aus ChurchTools sehen
- Kalender ausw√§hlen/abw√§hlen f√ºr die Synchronisation
- Status (√ñffentlich/Privat) einsehen
- Kalenderfarben sehen
- Auswahl speichern und Kalender neu laden

### Synchronisation

**Manuell:**
- Dashboard ‚Üí **Jetzt synchronisieren** (f√ºr Termine)
- Settings ‚Üí **Kalender jetzt synchronisieren** (f√ºr Kalender)

**Automatisch:**
- Implementierung via WP-Cron geplant (zuk√ºnftige Version)

## üìä Dashboard

Das Dashboard zeigt:

```
repro-ct-suite/
‚îú‚îÄ‚îÄ admin/                      # Admin-spezifische Funktionalit√§t
‚îÇ   ‚îú‚îÄ‚îÄ css/                    # Admin CSS
‚îÇ   ‚îú‚îÄ‚îÄ js/                     # Admin JavaScript
‚îÇ   ‚îú‚îÄ‚îÄ views/                  # Admin-Templates
‚îÇ   ‚îî‚îÄ‚îÄ class-repro-ct-suite-admin.php
‚îú‚îÄ‚îÄ public/                     # Public-facing Funktionalit√§t
‚îÇ   ‚îú‚îÄ‚îÄ css/                    # Public CSS
‚îÇ   ‚îú‚îÄ‚îÄ js/                     # Public JavaScript
‚îÇ   ‚îî‚îÄ‚îÄ class-repro-ct-suite-public.php
‚îú‚îÄ‚îÄ includes/                   # Core-Klassen
‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite.php
‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite-loader.php
‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite-i18n.php
‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite-activator.php
‚îÇ   ‚îî‚îÄ‚îÄ class-repro-ct-suite-deactivator.php
‚îú‚îÄ‚îÄ languages/                  # √úbersetzungsdateien
‚îú‚îÄ‚îÄ templates/                  # Frontend-Templates
‚îú‚îÄ‚îÄ assets/                     # Statische Assets (Bilder, etc.)
‚îú‚îÄ‚îÄ tests/                      # PHPUnit Tests
‚îú‚îÄ‚îÄ composer.json
‚îú‚îÄ‚îÄ phpunit.xml.dist
‚îî‚îÄ‚îÄ repro-ct-suite.php         # Haupt-Plugin-Datei
## üìä Dashboard

Das Dashboard zeigt:
- **Termine-Statistik**: Anzahl synchronisierter Termine
- **Verbindungsstatus**: Status der ChurchTools-Verbindung
- **N√§chste Termine**: Die 5 n√§chsten anstehenden Termine mit:
  - Datum & Uhrzeit
  - Titel
  - Ort
  - Quelle (Event/Termin Badge)
  - Kalenderfarbe

## üóÇÔ∏è Ordnerstruktur

```
repro-ct-suite/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îî‚îÄ‚îÄ release.yml          # GitHub Actions f√ºr Releases
‚îú‚îÄ‚îÄ admin/                        # Admin-Bereich
‚îÇ   ‚îú‚îÄ‚îÄ css/                      # Admin-Styles
‚îÇ   ‚îú‚îÄ‚îÄ js/                       # Admin-JavaScript (AJAX)
‚îÇ   ‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.php            # Haupt-Admin-Template
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tabs/                # Tab-Templates
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ tab-dashboard.php
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ tab-settings.php
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ tab-test-connection.php
‚îÇ   ‚îî‚îÄ‚îÄ class-repro-ct-suite-admin.php
‚îú‚îÄ‚îÄ includes/                     # Core-Klassen
‚îÇ   ‚îú‚îÄ‚îÄ repositories/            # Repository Pattern
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite-repository-base.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite-calendars-repository.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite-events-repository.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ class-repro-ct-suite-appointments-repository.php
‚îÇ   ‚îú‚îÄ‚îÄ services/                # Business Logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite-calendar-sync-service.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite-events-sync-service.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ class-repro-ct-suite-appointments-sync-service.php
‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite.php
‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite-ct-client.php  # ChurchTools API Client
‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite-crypto.php     # Verschl√ºsselung
‚îÇ   ‚îú‚îÄ‚îÄ class-repro-ct-suite-migrations.php # DB-Migrationen
‚îÇ   ‚îî‚îÄ‚îÄ class-repro-ct-suite-updater.php    # GitHub Updater
‚îú‚îÄ‚îÄ public/                       # Frontend
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îî‚îÄ‚îÄ class-repro-ct-suite-public.php
‚îú‚îÄ‚îÄ tests/                        # PHPUnit Tests
‚îú‚îÄ‚îÄ scripts/                      # Build-Scripts
‚îÇ   ‚îî‚îÄ‚îÄ create-plugin-zip.ps1    # ZIP-Erstellung
‚îú‚îÄ‚îÄ composer.json
‚îú‚îÄ‚îÄ phpunit.xml.dist
‚îî‚îÄ‚îÄ repro-ct-suite.php           # Haupt-Plugin-Datei
```

## üîß Entwicklung

### Setup

```bash
# Repository clonen
git clone https://github.com/FEGAschaffenburg/repro-ct-suite.git
cd repro-ct-suite

# Abh√§ngigkeiten installieren (optional, f√ºr Tests)
composer install
```

### Datenbank-Schema

**Tabellen:**
- `wp_rcts_calendars` - ChurchTools-Kalender
- `wp_rcts_events` - Events aus ChurchTools
- `wp_rcts_appointments` - Termine aus ChurchTools

**Migrationen:** Automatisch bei Plugin-Aktivierung via `class-repro-ct-suite-migrations.php`

### Tests ausf√ºhren

```bash
composer test
# oder
./vendor/bin/phpunit
```

### Neue Version ver√∂ffentlichen

1. Versionsnummer in `repro-ct-suite.php` aktualisieren
2. √Ñnderungen committen
3. Git-Tag erstellen:
   ```bash
   git tag v0.3.1
   git push origin v0.3.1
   ```
4. GitHub Actions erstellt automatisch:
   - Release
   - Plugin-ZIP
   - Release Notes

## üì° API-Endpunkte (AJAX)

Das Plugin stellt folgende AJAX-Endpunkte bereit:

- `wp_ajax_repro_ct_suite_sync_calendars` - Kalender synchronisieren
- `wp_ajax_repro_ct_suite_sync_appointments` - Termine synchronisieren

Alle Endpunkte sind durch Nonces gesichert.

## üîê Sicherheit

- **Passwort-Verschl√ºsselung**: ChurchTools-Passw√∂rter werden verschl√ºsselt gespeichert
- **Nonce-Validierung**: Alle AJAX-Requests sind CSRF-gesch√ºtzt
- **Capability-Checks**: Nur Admins (`manage_options`) k√∂nnen Einstellungen √§ndern
- **Prepared Statements**: Alle DB-Queries nutzen `$wpdb->prepare()`
- **Input-Sanitization**: Alle Eingaben werden validiert und bereinigt

## üîÑ Automatische Updates

Das Plugin unterst√ºtzt automatische Updates direkt von GitHub:

1. WordPress pr√ºft auf neue Versionen
2. Updates erscheinen wie bei WordPress.org-Plugins
3. Ein-Klick-Installation

**Hinweis**: Bei √∂ffentlichem Repository funktioniert dies ohne zus√§tzliche Konfiguration.

## üìù Changelog

### 0.3.0.1 (2025-10-29)
- **Bugfix**: Download-Filter f√ºr √∂ffentliche Repositories entfernt
- Token aus Code entfernt (vorbereitet f√ºr √∂ffentliches Repo)

### 0.3.0 (2025-10-29)
- **Feature**: AJAX-Integration f√ºr Kalender-Sync
- **Feature**: AJAX-Integration f√ºr Termine-Sync  
- **Feature**: Sync-Button im Dashboard
- **Feature**: Best√§tigungsdialog f√ºr Kalender-Sync
- **UI**: Loading-State w√§hrend Synchronisation
- **UI**: Auto-Reload nach erfolgreicher Sync
- **UI**: Detaillierte Sync-Statistiken

### 0.2.4.3 (2025-10-29)
- **Feature**: Kalender-Verwaltung im Settings-Tab
- **Feature**: Kalender-Auswahl f√ºr gefilterte Synchronisation
- **Feature**: Dashboard-Konsolidierung (kombinierte Termine-Ansicht)
- **Database**: Schema v2 mit Calendars-Tabelle
- **Repository**: Calendars Repository mit full CRUD
- **Service**: Calendar Sync Service

## ü§ù Beitragen

Pull Requests sind willkommen! F√ºr gr√∂√üere √Ñnderungen:

1. Forken Sie das Repository
2. Erstellen Sie einen Feature-Branch (`git checkout -b feature/AmazingFeature`)
3. Committen Sie Ihre √Ñnderungen (`git commit -m 'Add: AmazingFeature'`)
4. Pushen Sie zum Branch (`git push origin feature/AmazingFeature`)
5. √ñffnen Sie einen Pull Request

## üìÑ Lizenz

GPL v2 or later - siehe [LICENSE](LICENSE) Datei

## üë• Autor

**FEGAschaffenburg**
- GitHub: [@FEGAschaffenburg](https://github.com/FEGAschaffenburg)
- Repository: [repro-ct-suite](https://github.com/FEGAschaffenburg/repro-ct-suite)

## üÜò Support

Bei Fragen oder Problemen:
- [Issue erstellen](https://github.com/FEGAschaffenburg/repro-ct-suite/issues)
- [Releases ansehen](https://github.com/FEGAschaffenburg/repro-ct-suite/releases)

---

Made with ‚ù§Ô∏è for ChurchTools & WordPress
